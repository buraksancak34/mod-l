<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360¬∞ ƒ∞lker'in ƒ∞zlencesi</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #f6f8fd 0%, #f1f4ff 100%);
            color: #1e293b;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 40px rgba(31, 38, 135, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 50px rgba(31, 38, 135, 0.08);
            border-color: #6366f1;
        }

        .admin-sidebar {
            background: rgba(255, 255, 255, 0.98);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -15px 0 45px rgba(0, 0, 0, 0.08);
            z-index: 999999;
        }

        .custom-input {
            background: #ffffff !important;
            border: 2px solid #f1f5f9 !important;
            color: #1e293b !important;
            padding: 12px !important;
            border-radius: 14px !important;
            width: 100% !important;
            font-size: 14px !important;
            transition: all 0.2s;
        }

        .custom-input:focus {
            border-color: #6366f1 !important;
            background: #fff !important;
            outline: none;
        }

        .chart-container { position: relative; width: 100%; height: 350px; }
        
        .tab-btn { padding: 8px 4px; font-weight: 800; font-size: 10px; border-radius: 10px; transition: all 0.2s; text-transform: uppercase; }
        .tab-btn.active { background: #6366f1; color: white; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.2); }
        .tab-btn.inactive { background: #f8fafc; color: #94a3b8; }

        .btn-action {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-action:hover { filter: brightness(1.1); transform: scale(1.02); }

        .status-badge { padding: 5px 12px; border-radius: 30px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .badge-done { background: #dcfce7; color: #15803d; }
        .badge-pending { background: #fef9c3; color: #a16207; }
        .badge-other { background: #e0e7ff; color: #4338ca; }

        .glow-gold { text-shadow: 0 0 15px rgba(234, 179, 8, 0.4); color: #eab308; }
        .glow-bright-gold { text-shadow: 0 0 25px rgba(250, 204, 21, 0.7); color: #facc15; }
        
        .countdown-item {
            background: white;
            padding: 4px 10px;
            border-radius: 10px;
            border: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .mode-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 14px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }
        .mode-guest { background: #f1f5f9; color: #64748b; border: 1px solid #e2e8f0; }
        .mode-admin { background: #6366f1; color: white; border: 1px solid #4f46e5; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2); }

        .hidden-mode { display: none !important; }

        /* Notlar Kƒ±smƒ± - NET KIRMIZI */
        .important-note {
            color: #ef4444 !important;
            font-weight: 800 !important;
            opacity: 1 !important;
            font-style: normal !important;
        }

        /* Atat√ºrk S√∂z√º Animasyonu */
        #ata-quote-wrapper {
            position: relative;
            overflow: hidden;
            height: 80px;
            width: 100%;
        }

        .quote-slide {
            position: absolute;
            width: 100%;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
        }

        .quote-enter { transform: translateX(100%); opacity: 0; }
        .quote-active { transform: translateX(0); opacity: 1; }
        .quote-exit { transform: translateX(-100%); opacity: 0; }
    </style>
</head>
<body class="antialiased">

    <!-- Admin Panel -->
    <div id="admin-panel" class="fixed top-0 right-0 h-full w-96 admin-sidebar translate-x-full overflow-y-auto p-8 border-l border-slate-100">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-black text-slate-800 flex items-center gap-3 underline decoration-indigo-500 decoration-4 underline-offset-4">‚öôÔ∏è Veri Merkezi</h2>
            <button onclick="window.toggleAdmin()" class="text-slate-300 hover:text-slate-600 text-3xl transition-colors">&times;</button>
        </div>

        <div class="flex gap-1 mb-8 bg-slate-50 p-1 rounded-2xl">
            <button onclick="window.switchSidebarTab('stats')" id="tab-stats" class="tab-btn active flex-1">Sayƒ±lar</button>
            <button onclick="window.switchSidebarTab('contacts')" id="tab-contacts" class="tab-btn inactive flex-1">Ki≈üiler</button>
            <button onclick="window.switchSidebarTab('todos')" id="tab-todos" class="tab-btn inactive flex-1">G√∂revler</button>
            <button onclick="window.switchSidebarTab('quotes')" id="tab-quotes" class="tab-btn inactive flex-1">S√∂zler</button>
        </div>
        
        <!-- Sayƒ±lar -->
        <div id="sidebar-stats-content">
            <div id="editor-list" class="space-y-5 mb-8"></div>
            <div class="pt-8 border-t border-slate-100 space-y-3">
                <button onclick="window.addNewCategory()" class="w-full py-4 btn-action rounded-2xl text-sm font-bold shadow-xl border-none">+ Yeni Kategori</button>
            </div>
        </div>

        <!-- Ki≈üiler -->
        <div id="sidebar-contacts-content" class="hidden space-y-5">
            <div class="flex justify-between items-center">
                <h3 class="text-indigo-600 text-[10px] font-black uppercase tracking-widest" id="contact-form-title">Yeni Kayƒ±t</h3>
                <button onclick="window.resetContactForm()" id="btn-cancel-edit" class="hidden text-rose-500 text-[10px] font-bold uppercase">ƒ∞ptal</button>
            </div>
            <div class="space-y-4">
                <input type="hidden" id="contact-edit-id">
                <input type="text" id="contact-name" placeholder="Ad Soyad / √únvan" class="custom-input">
                <select id="contact-type" class="custom-input"></select>
                <input type="email" id="contact-email" placeholder="E-posta" class="custom-input">
                <input type="tel" id="contact-phone" placeholder="Telefon" class="custom-input">
                <div class="pt-4 border-t border-slate-100">
                    <label class="text-[10px] font-bold text-slate-400 mb-2 block uppercase">Referans Bilgisi</label>
                    <input type="text" id="contact-ref-name" placeholder="Referans ƒ∞smi" class="custom-input mb-3">
                    <input type="tel" id="contact-ref-phone" placeholder="Referans Telefonu" class="custom-input">
                </div>
                <textarea id="contact-note" placeholder="Notlar..." class="custom-input h-24"></textarea>
                <button onclick="window.addContactToCloud()" id="btn-save-contact" class="w-full py-4 btn-action rounded-2xl font-extrabold text-sm shadow-xl">KAYDET</button>
            </div>
        </div>

        <!-- G√∂revler -->
        <div id="sidebar-todos-content" class="hidden space-y-5">
            <h3 class="text-indigo-600 text-[10px] font-black uppercase mb-4">G√∂rev Planlayƒ±cƒ±</h3>
            <div class="space-y-4">
                <input type="text" id="todo-task" placeholder="Yeni G√∂rev..." class="custom-input">
                <select id="todo-status" class="custom-input">
                    <option value="Yapƒ±lmadƒ±">Yapƒ±lmadƒ±</option>
                    <option value="Yapƒ±ldƒ±">Yapƒ±ldƒ±</option>
                    <option value="Diƒüer">Diƒüer</option>
                </select>
                <textarea id="todo-desc" placeholder="A√ßƒ±klama..." class="custom-input h-24"></textarea>
                <button onclick="window.addTodoToCloud()" class="w-full py-4 btn-action rounded-2xl font-black text-sm">G√ñREV EKLE</button>
                <button onclick="window.seedInitialTodos()" class="w-full py-3 bg-rose-50 text-rose-500 rounded-2xl text-[10px] font-bold uppercase mt-10">G√∂revleri Sƒ±fƒ±rla</button>
            </div>
        </div>

        <!-- S√∂zler -->
        <div id="sidebar-quotes-content" class="hidden space-y-5">
            <h3 class="text-indigo-600 text-[10px] font-black uppercase mb-4">S√∂z Havuzu</h3>
            <div class="space-y-4">
                <textarea id="new-quote-text" placeholder="Yeni bir s√∂z ekleyin..." class="custom-input h-24"></textarea>
                <button onclick="window.addQuoteToCloud()" class="w-full py-4 btn-action rounded-2xl font-black text-sm">S√ñZ EKLE</button>
                <div id="quote-manager-list" class="pt-4 space-y-3"></div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 py-12">
        <header class="flex flex-col md:flex-row justify-between items-start mb-16 gap-8 text-center md:text-left">
            <div>
                <h1 class="text-5xl md:text-7xl font-black text-slate-800 tracking-tighter leading-none m-0 uppercase">
                    ƒ∞LKER'ƒ∞N <span class="text-indigo-600 italic">ƒ∞ZLENCESƒ∞</span>
                </h1>
                <p id="sub-title" class="text-slate-400 text-lg mt-3 font-semibold">Stratejik ƒ∞lerleme ve Veri Analizi ‚ú®</p>
                
                <div class="mt-6 flex flex-col gap-6 items-center md:items-start w-full">
                    <div class="flex flex-wrap gap-3 justify-center md:justify-start items-center">
                        <div id="mode-status" class="mode-indicator mode-guest">
                            <span id="mode-icon">üë§</span>
                            <span id="mode-text">Misafir Modu</span>
                        </div>
                        <button id="btn-login-toggle" onclick="window.handleAuth()" class="text-[10px] font-black uppercase tracking-widest text-indigo-500 hover:text-indigo-700 underline transition-all">Y√∂netici Giri≈üi</button>
                        
                        <button onclick="window.toggleAdmin()" id="btn-master-manage" class="hidden-mode bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold text-xs uppercase tracking-widest hover:shadow-lg transition-all cursor-pointer">
                            üõ†Ô∏è Verileri Y√∂net
                        </button>
                    </div>

                    <!-- Atat√ºrk S√∂z√º B√∂l√ºm√º (Kayan) -->
                    <div id="ata-quote-container" class="max-w-xl w-full">
                        <div id="ata-quote-wrapper">
                            <!-- JS ile kayan s√∂zler buraya gelecek -->
                        </div>
                        <p id="ata-author" class="text-indigo-500 text-[10px] font-black uppercase tracking-widest mt-2 pl-5">Mustafa Kemal Atat√ºrk</p>
                    </div>
                </div>
            </div>

            <div class="glass-card p-5 rounded-[2rem] flex flex-col gap-2 min-w-[280px]">
                <h3 class="text-[9px] font-black text-slate-400 uppercase tracking-[2px] mb-1 text-center">Akademik Takvim & Geri Sayƒ±m</h3>
                <div id="countdown-list" class="space-y-1.5"></div>
            </div>
        </header>

        <div id="stats-summary" class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-16"></div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-24">
            <div class="lg:col-span-5 glass-card p-10 rounded-[3rem] flex flex-col items-center">
                <h3 class="text-slate-400 text-[10px] font-black uppercase tracking-[3px] mb-8 text-center w-full">Aƒü Dengesi Analizi</h3>
                <div class="chart-container"><canvas id="radarChart"></canvas></div>
            </div>
            <div class="lg:col-span-7">
                <div id="card-view" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
            </div>
        </div>

        <div class="space-y-24">
            <section>
                <div class="flex justify-between items-end mb-8 px-4">
                    <h2 class="text-3xl font-black text-slate-800 uppercase tracking-tight">üìÖ ƒ∞leti≈üim Rehberi</h2>
                    <button onclick="window.toggleAdmin(); window.switchSidebarTab('contacts')" class="hidden-mode text-indigo-600 font-black text-xs uppercase hover:underline">+ Yeni Ki≈üi</button>
                </div>
                <div class="glass-card rounded-[3rem] overflow-hidden border-none shadow-xl">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse min-w-[1000px]">
                            <thead class="bg-slate-50/50 text-slate-400 uppercase text-[10px] font-black tracking-widest border-b border-slate-100">
                                <tr>
                                    <th class="px-8 py-6">AD SOYAD</th>
                                    <th class="px-8 py-6">KATEGORƒ∞</th>
                                    <th class="px-8 py-6">ƒ∞LETƒ∞≈ûƒ∞M</th>
                                    <th class="px-8 py-6">ARACI</th>
                                    <th class="px-8 py-6">NOTLAR</th>
                                    <th class="px-8 py-6 text-right">EYLEM</th>
                                </tr>
                            </thead>
                            <tbody id="contacts-table-body" class="divide-y divide-slate-50"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section>
                <div class="flex justify-between items-end mb-8 px-4">
                    <h2 class="text-3xl font-black text-slate-800 uppercase tracking-tight">‚úÖ Akademik G√∂revler</h2>
                    <button onclick="window.toggleAdmin(); window.switchSidebarTab('todos')" class="hidden-mode text-indigo-600 font-black text-xs uppercase hover:underline">+ Yeni G√∂rev</button>
                </div>
                <div class="glass-card rounded-[3rem] overflow-hidden border-none shadow-xl">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse min-w-[800px]">
                            <thead class="bg-slate-50/50 text-slate-400 uppercase text-[10px] font-black tracking-widest border-b border-slate-100">
                                <tr>
                                    <th class="px-8 py-6">G√ñREV TANIMI</th>
                                    <th class="px-8 py-6 w-48">DURUM</th>
                                    <th class="px-8 py-6">A√áIKLAMA / NOT</th>
                                    <th class="px-8 py-6 text-right">EYLEM</th>
                                </tr>
                            </thead>
                            <tbody id="todo-table-body" class="divide-y divide-slate-50"></tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, updateDoc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCbIuOJeKNpJToMg2-PsblLtue-mzElUQY",
            authDomain: "tezz-95f0d.firebaseapp.com",
            projectId: "tezz-95f0d",
            storageBucket: "tezz-95f0d.firebasestorage.app",
            messagingSenderId: "87135277271",
            appId: "1:87135277271:web:49cc5d5ee7b473bfa7a092",
            measurementId: "G-D2WLJXGP67"
        };

        const appId = 'tezz-prod-v1';
        let isAdmin = false;
        let quoteInterval = null;
        let currentQuoteIndex = 0;

        const deadlines = [
            { label: 'Savunma G√ºn√º', date: '2026-06-15', emoji: 'üéì' },
            { label: 'Tez Biti≈üi', date: '2026-06-01', emoji: 'üìö' },
            { label: 'Sonu√ßlarƒ±n Yazƒ±mƒ±', date: '2026-05-15', emoji: '‚úçÔ∏è' },
            { label: 'Analizin Yazƒ±mƒ±', date: '2026-04-27', emoji: 'üìä' },
            { label: 'Veri Analizi', date: '2026-04-05', emoji: 'üîç' }
        ];

        let db, auth, radarChart;
        let stats = [], contacts = [], todos = [], quotes = [];

        const startApp = async () => {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            await signInAnonymously(auth);
            
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    await checkAdminStatus(user.uid);
                    setupListeners();
                }
            });
            renderCountdowns();
        };

        const setupListeners = () => {
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'gorusmeler'), (snap) => {
                stats = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a, b) => (a.order || 0) - (b.order || 0));
                renderDash(); renderStatsEditor(); updateRadar(); updateContactDropdown();
            });
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'randevular'), (snap) => {
                contacts = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderContacts();
            });
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'yapilacaklar'), (snap) => {
                todos = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b) => (a.createdAt || 0) - (b.createdAt || 0));
                renderTodos();
            });
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'sozler'), (snap) => {
                quotes = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderQuotesAdmin();
                startQuoteRotation();
            });
        };

        // --- ATATURK QUOTE SLIDER LOGIC ---
        function startQuoteRotation() {
            if (quoteInterval) clearInterval(quoteInterval);
            if (quotes.length === 0) return;

            displayNextQuote();
            quoteInterval = setInterval(displayNextQuote, 15000); // 15 Saniyede Bir
        }

        function displayNextQuote() {
            const wrapper = document.getElementById('ata-quote-wrapper');
            if (!wrapper) return;

            const nextIndex = (currentQuoteIndex + 1) % quotes.length;
            const currentQuoteText = quotes[currentQuoteIndex]?.text || "";
            const nextQuoteText = quotes[nextIndex]?.text || "";

            // Yeni s√∂z elementi olu≈ütur
            const nextQuoteEl = document.createElement('p');
            nextQuoteEl.className = 'quote-slide quote-enter text-slate-700 text-sm font-semibold italic leading-relaxed border-l-4 border-indigo-400 pl-5 py-2';
            nextQuoteEl.innerText = `"${nextQuoteText}"`;
            
            wrapper.appendChild(nextQuoteEl);

            // Mevcut olanƒ± √ßƒ±kar, yeniyi merkeze getir
            setTimeout(() => {
                const currentEl = wrapper.querySelector('.quote-active');
                if (currentEl) {
                    currentEl.classList.replace('quote-active', 'quote-exit');
                    setTimeout(() => currentEl.remove(), 800);
                }
                nextQuoteEl.classList.replace('quote-enter', 'quote-active');
            }, 50);

            currentQuoteIndex = nextIndex;
        }

        // --- ADMIN PERSISTENCE ---
        async function checkAdminStatus(userId) {
            const adminDoc = await getDoc(doc(db, 'artifacts', appId, 'users', userId, 'permissions', 'adminStatus'));
            if (adminDoc.exists() && adminDoc.data().isAuthorized === true) {
                isAdmin = true;
            }
            updateUIForMode();
        }

        async function saveAdminStatus(isAuthorized) {
            if (!auth.currentUser) return;
            await setDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'permissions', 'adminStatus'), { 
                isAuthorized: isAuthorized,
                updatedAt: Date.now()
            });
        }

        window.handleAuth = async () => {
            if (!isAdmin) {
                const pass = prompt("Y√∂netici ≈üifresini girin:");
                if (pass === "531") {
                    isAdmin = true;
                    await saveAdminStatus(true);
                    updateUIForMode();
                } else {
                    alert("Hatalƒ± ≈üifre!");
                }
            } else {
                if (confirm("Y√∂netici oturumunu kapatmak istediƒüinize emin misiniz?")) {
                    isAdmin = false;
                    await saveAdminStatus(false);
                    if(!document.getElementById('admin-panel').classList.contains('translate-x-full')) {
                        document.getElementById('admin-panel').classList.add('translate-x-full');
                    }
                    updateUIForMode();
                }
            }
        };

        function updateUIForMode() {
            const status = document.getElementById('mode-status');
            const icon = document.getElementById('mode-icon');
            const text = document.getElementById('mode-text');
            const btn = document.getElementById('btn-login-toggle');
            const masterBtn = document.getElementById('btn-master-manage');
            const hiddenElements = document.querySelectorAll('.hidden-mode');

            if (isAdmin) {
                status.className = "mode-indicator mode-admin";
                icon.innerText = "üõ°Ô∏è"; text.innerText = "Y√∂netici Aktif";
                btn.innerText = "G√ºvenli √áƒ±kƒ±≈ü";
                masterBtn.classList.remove('hidden-mode');
                hiddenElements.forEach(el => el.classList.remove('hidden-mode'));
            } else {
                status.className = "mode-indicator mode-guest";
                icon.innerText = "üë§"; text.innerText = "Misafir Modu";
                btn.innerText = "Y√∂netici Giri≈üi";
                masterBtn.classList.add('hidden-mode');
            }
            renderContacts(); renderTodos();
        }

        // --- RENDERS ---
        function renderDash() {
            const container = document.getElementById('card-view');
            const summary = document.getElementById('stats-summary');
            if(!container || !summary) return;
            container.innerHTML = '';
            let tDone = 0, tTarget = 0;
            stats.forEach(item => {
                const perc = item.total > 0 ? Math.round((item.completed/item.total)*100) : 0;
                tDone += item.completed; tTarget += item.total;
                const color = perc === 100 ? 'text-emerald-500' : (item.completed === 0 ? 'text-rose-500' : 'text-indigo-600');
                const card = document.createElement('div');
                card.className = 'glass-card rounded-[2.5rem] p-8 text-left';
                let icons = '';
                for(let i=0; i<item.total; i++) icons += `<span class="text-2xl ${i < item.completed ? '' : 'opacity-20 grayscale'}">${item.emoji || 'üìå'}</span>`;
                card.innerHTML = `<div class="flex justify-between items-start mb-6"><div><h3 class="font-black text-slate-800 text-lg">${item.title}</h3><p class="text-[10px] text-slate-400 font-black uppercase tracking-wider">${item.completed}/${item.total}</p></div><span class="text-3xl font-black ${color}">${perc}%</span></div><div class="flex flex-wrap gap-2 mb-6 min-h-[30px]">${icons}</div><div class="h-2 bg-slate-100 rounded-full overflow-hidden"><div class="h-full ${perc === 100 ? 'bg-emerald-500' : (item.completed === 0 ? 'bg-rose-500' : 'bg-gradient-to-r from-indigo-600 to-purple-600')} transition-all duration-1000" style="width:${perc}%"></div></div>`;
                container.appendChild(card);
            });
            const overall = tTarget > 0 ? Math.round((tDone/tTarget)*100) : 0;
            let theme = { class: 'text-indigo-600', label: 'ƒ∞yi Gidiyor' };
            if (overall >= 90) theme = { class: 'glow-bright-gold text-yellow-400', label: 'Efsane!' };
            else if (overall >= 70) theme = { class: 'glow-gold text-yellow-600', label: 'Harika!' };
            else if (overall < 40) theme = { class: 'text-critical', label: 'Hƒ±zlanmalƒ±sƒ±n' };
            summary.innerHTML = `<div class="glass-card p-6 rounded-[2.5rem] border-l-8 border-indigo-500 text-center shadow-sm"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Ba≈üarƒ±</p><p class="text-5xl font-black ${theme.class} mt-2">%${overall}</p><p class="text-[10px] font-bold opacity-40 mt-1 uppercase">${theme.label}</p></div><div class="glass-card p-6 rounded-[2.5rem] text-center shadow-sm"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Biten</p><p class="text-4xl font-black text-slate-800 mt-2">${tDone}</p></div><div class="glass-card p-6 rounded-[2.5rem] text-center shadow-sm"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Kalan</p><p class="text-4xl font-black text-indigo-600 mt-2">${tTarget-tDone}</p></div><div class="glass-card p-6 rounded-[2.5rem] text-center shadow-sm"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Grup</p><p class="text-4xl font-black text-slate-800 mt-2">${stats.length}</p></div>`;
        }

        function renderContacts() {
            const body = document.getElementById('contacts-table-body');
            if(!body) return;
            body.innerHTML = contacts.length === 0 ? '<tr><td colspan="6" class="p-16 text-center text-slate-300 italic">Hen√ºz kimse eklenmedi.</td></tr>' : '';
            contacts.forEach(c => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-indigo-50/50 transition-colors text-sm text-left';
                const actionBtns = isAdmin ? `<button onclick="window.editContact('${c.id}')" class="text-indigo-600 hover:text-indigo-800 font-black text-[10px] uppercase cursor-pointer mr-3">D√úZENLE</button><button onclick="window.deleteContact('${c.id}')" class="text-rose-400 hover:text-rose-600 font-black text-[10px] uppercase cursor-pointer">Sƒ∞L</button>` : `<span class="text-[9px] font-bold text-slate-300 italic">Salt Okunur</span>`;
                tr.innerHTML = `<td class="px-8 py-6 font-bold text-slate-800">${c.name}</td><td class="px-8 py-6"><span class="bg-indigo-100 text-indigo-600 px-3 py-1 rounded-lg text-[10px] font-black uppercase">${c.type}</span></td><td class="px-8 py-6 text-slate-500 font-medium">üìß ${c.email || '-'}<br>üìû ${c.phone || '-'}</td><td class="px-8 py-6 text-slate-500">üë§ ${c.refName || '-'}<br><span class="text-xs">üì± ${c.refPhone || '-'}</span></td><td class="px-8 py-6 max-w-[200px] text-sm important-note italic">${c.note || '-'}</td><td class="px-8 py-6 text-right">${actionBtns}</td>`;
                body.appendChild(tr);
            });
        }

        function renderTodos() {
            const body = document.getElementById('todo-table-body');
            if(!body) return;
            body.innerHTML = '';
            todos.forEach(t => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-50 transition-colors text-sm text-left';
                const statusClass = t.status === 'Yapƒ±ldƒ±' ? 'badge-done' : (t.status === 'Diƒüer' ? 'badge-other' : 'badge-pending');
                const actionBtn = isAdmin ? `<button onclick="window.deleteTodo('${t.id}')" class="text-rose-300 hover:text-rose-500 font-black text-[10px] uppercase cursor-pointer">Sƒ∞L</button>` : `<span class="text-[9px] font-bold text-slate-300 italic">Salt Okunur</span>`;
                const statusSelect = isAdmin ? `<select onchange="window.updateTodoStatus('${t.id}', this.value)" class="bg-white border border-slate-100 p-2 rounded-xl status-badge ${statusClass} font-black cursor-pointer outline-none"><option value="Yapƒ±lmadƒ±" ${t.status === 'Yapƒ±lmadƒ±' ? 'selected' : ''}>Yapƒ±lmadƒ±</option><option value="Yapƒ±ldƒ±" ${t.status === 'Yapƒ±ldƒ±' ? 'selected' : ''}>Yapƒ±ldƒ±</option><option value="Diƒüer" ${t.status === 'Diƒüer' ? 'selected' : ''}>Diƒüer</option></select>` : `<span class="status-badge ${statusClass}">${t.status}</span>`;
                const descInput = isAdmin ? `<input type="text" value="${t.desc || ''}" placeholder="Detay ekle..." onchange="window.updateTodoDesc('${t.id}', this.value)" class="bg-transparent border-b-2 border-slate-100 focus:border-indigo-400 outline-none w-full text-sm important-note italic py-1">` : `<span class="text-sm important-note italic">${t.desc || '-'}</span>`;
                tr.innerHTML = `<td class="px-8 py-6 text-slate-800 font-bold">${t.task}</td><td class="px-8 py-6">${statusSelect}</td><td class="px-8 py-6">${descInput}</td><td class="px-8 py-6 text-right">${actionBtn}</td>`;
                body.appendChild(tr);
            });
        }

        function renderQuotesAdmin() {
            const list = document.getElementById('quote-manager-list');
            if(!list) return;
            list.innerHTML = quotes.map(q => `<div class="p-4 bg-slate-50 border border-slate-100 rounded-xl relative group text-left"><p class="text-[11px] text-slate-600 italic pr-8">"${q.text}"</p><button onclick="window.deleteQuote('${q.id}')" class="absolute top-2 right-2 text-rose-400 opacity-0 group-hover:opacity-100 transition-all font-bold text-[9px] cursor-pointer">Sƒ∞L</button></div>`).join('');
        }

        // --- UPDATE ACTIONS ---
        window.updateValue = async (id, field, value) => {
            if(!isAdmin) return;
            const val = (field === 'completed' || field === 'total') ? parseInt(value) || 0 : value;
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'gorusmeler', id), { [field]: val });
        };

        window.addContactToCloud = async () => {
            if(!isAdmin) return;
            const id = document.getElementById('contact-edit-id').value;
            const cData = { name: document.getElementById('contact-name').value, type: document.getElementById('contact-type').value, email: document.getElementById('contact-email').value, phone: document.getElementById('contact-phone').value, refName: document.getElementById('contact-ref-name').value, refPhone: document.getElementById('contact-ref-phone').value, note: document.getElementById('contact-note').value, updatedAt: Date.now() };
            if(id) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'randevular', id), cData);
            else { cData.createdAt = Date.now(); await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'randevular', `c-${Date.now()}`), cData); }
            window.resetContactForm();
        };

        window.editContact = (id) => {
            const c = contacts.find(i => i.id === id);
            if(!c) return;
            document.getElementById('contact-edit-id').value = c.id;
            document.getElementById('contact-name').value = c.name;
            document.getElementById('contact-type').value = c.type;
            document.getElementById('contact-email').value = c.email || '';
            document.getElementById('contact-phone').value = c.phone || '';
            document.getElementById('contact-ref-name').value = c.refName || '';
            document.getElementById('contact-ref-phone').value = c.refPhone || '';
            document.getElementById('contact-note').value = c.note || '';
            document.getElementById('contact-form-title').innerText = "Kayƒ±t G√ºncelleme";
            document.getElementById('btn-cancel-edit').classList.remove('hidden');
            document.getElementById('btn-save-contact').innerText = "G√úNCELLE";
            window.switchSidebarTab('contacts');
            if(document.getElementById('admin-panel').classList.contains('translate-x-full')) window.toggleAdmin();
        };

        window.resetContactForm = () => {
            ['contact-edit-id','contact-name','contact-email','contact-phone','contact-ref-name','contact-ref-phone','contact-note'].forEach(i => document.getElementById(i).value = '');
            document.getElementById('contact-form-title').innerText = "Yeni Kayƒ±t";
            document.getElementById('btn-cancel-edit').classList.add('hidden');
            document.getElementById('btn-save-contact').innerText = "KAYDET";
        };

        window.addTodoToCloud = async () => {
            if(!isAdmin) return;
            const task = document.getElementById('todo-task').value;
            if(!task) return;
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'yapilacaklar', `t-${Date.now()}`), { task, status: document.getElementById('todo-status').value, desc: document.getElementById('todo-desc').value, createdAt: Date.now() });
            document.getElementById('todo-task').value = ''; document.getElementById('todo-desc').value = '';
        };

        window.updateTodoStatus = async (id, status) => { if(isAdmin) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'yapilacaklar', id), { status }); };
        window.updateTodoDesc = async (id, desc) => { if(isAdmin) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'yapilacaklar', id), { desc }); };
        window.deleteTodo = async (id) => isAdmin && confirm('Silinsin mi?') && await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'yapilacaklar', id));
        window.deleteContact = async (id) => isAdmin && confirm('Ki≈üi silinsin mi?') && await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'randevular', id));

        window.addQuoteToCloud = async () => {
            if(!isAdmin) return;
            const text = document.getElementById('new-quote-text').value;
            if(!text) return;
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'sozler', `q-${Date.now()}`), { text, createdAt: Date.now() });
            document.getElementById('new-quote-text').value = '';
        };

        window.deleteQuote = async (id) => { if(isAdmin && confirm('S√∂z silinsin mi?')) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'sozler', id)); };

        // --- UTILS ---
        window.switchSidebarTab = (tab) => {
            ['stats', 'contacts', 'todos', 'quotes'].forEach(t => {
                document.getElementById(`tab-${t}`).className = `tab-btn flex-1 text-center ${t === tab ? 'active' : 'inactive'}`;
                document.getElementById(`sidebar-${t}-content`).className = t === tab ? '' : 'hidden';
            });
        };

        window.toggleAdmin = () => {
            if(!isAdmin) {
                const pass = prompt("Y√∂netici ≈ûifresi:");
                if(pass === "531") { isAdmin = true; saveAdminStatus(true); updateUIForMode(); }
                else return;
            }
            document.getElementById('admin-panel').classList.toggle('translate-x-full');
        };

        function renderCountdowns() {
            const list = document.getElementById('countdown-list');
            list.innerHTML = '';
            const now = new Date();
            deadlines.forEach(item => {
                const target = new Date(item.date);
                const diffTime = target - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                let colorClass = 'text-slate-600';
                if (diffDays <= 30) colorClass = 'text-rose-500 font-black';
                else if (diffDays <= 90) colorClass = 'text-indigo-600 font-bold';
                const div = document.createElement('div');
                div.className = 'countdown-item';
                div.innerHTML = `<span class="text-xs">${item.emoji}</span><span class="text-[10px] font-bold text-slate-400 flex-1 truncate">${item.label}</span><span class="text-xs ${colorClass}">${diffDays > 0 ? diffDays + ' g√ºn' : 'Bitti'}</span>`;
                list.appendChild(div);
            });
        }

        function updateContactDropdown() {
            const select = document.getElementById('contact-type');
            if(!select) return;
            const cur = select.value;
            select.innerHTML = '<option value="">Kategori Se√ß...</option>' + stats.map(s => `<option value="${s.title}">${s.title}</option>`).join('');
            select.value = cur;
        }

        function renderStatsEditor() {
            const list = document.getElementById('editor-list');
            if(!list) return;
            list.innerHTML = stats.map(i => `<div class="p-5 bg-slate-50 border border-slate-100 rounded-[1.5rem] relative text-left">
                <button onclick="window.removeCategory('${i.id}')" class="absolute top-2 right-2 text-rose-400 font-bold border-none bg-transparent cursor-pointer">Sil</button>
                <div class="space-y-3">
                    <div><label class="text-[10px] font-black text-slate-400 uppercase ml-1">Kategori</label><input type="text" value="${i.title}" class="custom-input" onblur="window.updateValue('${i.id}', 'title', this.value)"></div>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-[10px] font-black text-slate-400 uppercase ml-1">Biten</label><input type="number" value="${i.completed}" class="custom-input" onblur="window.updateValue('${i.id}', 'completed', this.value)"></div>
                        <div><label class="text-[10px] font-black text-slate-400 uppercase ml-1">Hedef</label><input type="number" value="${i.total}" class="custom-input" onblur="window.updateValue('${i.id}', 'total', this.value)"></div>
                    </div>
                </div>
            </div>`).join('');
        }

        function updateRadar() {
            const canvas = document.getElementById('radarChart');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            if(radarChart) radarChart.destroy();
            radarChart = new Chart(ctx, { type: 'radar', data: { labels: stats.map(d => d.title), datasets: [{ label: '% Ba≈üarƒ±', data: stats.map(d => (d.completed/d.total)*100), backgroundColor: 'rgba(99, 102, 241, 0.15)', borderColor: '#6366f1', borderWidth: 3, pointBackgroundColor: '#fff', pointRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { r: { angleLines: { color: '#f1f5f9' }, grid: { color: '#f1f5f9' }, pointLabels: { color: '#64748b', font: { size: 10, weight: '700', family: 'Plus Jakarta Sans' } }, ticks: { display: false }, suggestedMin: 0, suggestedMax: 100 } }, plugins: { legend: { display: false } } } });
        }

        window.addNewCategory = async () => isAdmin && await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'gorusmeler', `cat-${Date.now()}`), { title: 'Yeni', completed: 0, total: 5, emoji: 'üìå', order: stats.length + 1 });
        window.removeCategory = async (id) => isAdmin && confirm('Silinsin mi?') && await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'gorusmeler', id));

        startApp();
    </script>
</body>
</html>
